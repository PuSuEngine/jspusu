!function e(t,r,n){function o(i,c){if(!r[i]){if(!t[i]){var u="function"==typeof require&&require;if(!c&&u)return u(i,!0);if(s)return s(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var h=r[i]={exports:{}};t[i][0].call(h.exports,function(e){var r=t[i][1][e];return o(r?r:e)},h,h.exports,e,t,r,n)}return r[i].exports}for(var s="function"==typeof require&&require,i=0;i<n.length;i++)o(n[i]);return o}({1:[function(e,t,r){function n(){h&&c&&(h=!1,c.length?a=c.concat(a):f=-1,a.length&&o())}function o(){if(!h){var e=setTimeout(n);h=!0;for(var t=a.length;t;){for(c=a,a=[];++f<t;)c&&c[f].run();f=-1,t=a.length}c=null,h=!1,clearTimeout(e)}}function s(e,t){this.fun=e,this.array=t}function i(){}var c,u=t.exports={},a=[],h=!1,f=-1;u.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];a.push(new s(e,t)),1!==a.length||h||setTimeout(o,0)},s.prototype.run=function(){this.fun.apply(null,this.array)},u.title="browser",u.browser=!0,u.env={},u.argv=[],u.version="",u.versions={},u.on=i,u.addListener=i,u.once=i,u.off=i,u.removeListener=i,u.removeAllListeners=i,u.emit=i,u.binding=function(e){throw new Error("process.binding is not supported")},u.cwd=function(){return"/"},u.chdir=function(e){throw new Error("process.chdir is not supported")},u.umask=function(){return 0}},{}],2:[function(e,t,r){(function(n){"use strict";function o(e){e.PuSu=c}var s=e("./tsd"),i=0;i&&console.log("PuSu debug mode enabled.");var c=function(){function e(e){this.timeout=5e3,this._waiters=[],this._subscribers={},this._server=e}return Object.defineProperty(e,"TYPE_HELLO",{get:function(){return"hello"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"TYPE_AUTHORIZE",{get:function(){return"authorize"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"TYPE_AUTHORIZATION_OK",{get:function(){return"authorization_ok"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"TYPE_PUBLISH",{get:function(){return"publish"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"TYPE_SUBSCRIBE",{get:function(){return"subscribe"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"TYPE_SUBSCRIBE_OK",{get:function(){return"subscribe_ok"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"TYPE_UNSUBSCRIBE",{get:function(){return"unsubscribe"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"TYPE_UNKNOWN_MESSAGE_RECEIVED",{get:function(){return"unknown_message_received"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"TYPE_AUTHORIZATION_FAILED",{get:function(){return"authorization_failed"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"TYPE_PERMISSION_DENIED",{get:function(){return"permission_denied"},enumerable:!0,configurable:!0}),e.prototype.connect=function(t){var r=s.create();return this._socket&&this.disconnect(),i&&console.log("Connecting to "+this._server),this._closeListener=t,this._socket=new WebSocket(this._server),this._socket.onclose=this._onclose.bind(this),this._socket.onmessage=this._onmessage.bind(this),this._socket.onerror=this._onerror.bind(this),this._socket.onopen=this._onopen.bind(this),this._wait(e.TYPE_HELLO,r),r},e.prototype.disconnect=function(){this._socket&&this._socket.close(),this._socket=null},e.prototype.authorize=function(t){var r=s.create();return this._socket.send(JSON.stringify({type:e.TYPE_AUTHORIZE,authorization:t})),this._wait(e.TYPE_AUTHORIZATION_OK,r),r},e.prototype.subscribe=function(t,r){var n=s.create(),o=!0;return this._subscribers[t]&&0!==this._subscribers[t].length||(this._subscribers[t]=[],o=!1),this._subscribers[t].push(r),o?n.resolve():(this._socket.send(JSON.stringify({type:e.TYPE_SUBSCRIBE,channel:t})),this._wait(e.TYPE_SUBSCRIBE_OK,n)),n},e.prototype.unsubscribe=function(t){var r=!1;this._subscribers[t]&&(r=!0,this._subscribers[t]=[]),r&&this._socket.send(JSON.stringify({type:e.TYPE_UNSUBSCRIBE,channel:t}))},e.prototype.publish=function(t,r){this._socket.send(JSON.stringify({type:e.TYPE_PUBLISH,channel:t,content:r}))},e.prototype._wait=function(e,t){var r=!1;i&&console.log("Waiting for "+e);var n=this,o=function s(o){if(e==o){var i=n._waiters.indexOf(s);if(-1===i)return;n._waiters.splice(i,1),r||(r=!0,t.resolve())}};this._waiters.push(o),setTimeout(function(){var s=n._waiters.indexOf(o);-1!==s&&(n._waiters.splice(s,1),r||(r=!0,console.log("Timeout exceeded waiting for "+e),t.reject()))},this.timeout)},e.prototype._onReceiveMessage=function(e){this._subscribers[e.channel]&&this._subscribers[e.channel].forEach(function(t){t(e.content)})},e.prototype._onclose=function(e){i&&(console.log("Connection to "+this._server+" closed."),console.error(e)),this._waiters=[],this._subscribers={},this._closeListener&&this._closeListener(e)},e.prototype._onmessage=function(t){var r=JSON.parse(t.data);this._waiters.forEach(function(e){e(r.type)}),r.type===e.TYPE_PUBLISH&&this._onReceiveMessage(r)},e.prototype._onerror=function(e){i&&(console.log("Got an error from "+this._server+"."),console.error(e))},e.prototype._onopen=function(e){i&&console.log("Connection to "+this._server+' established, waiting for "Hello".')},e}();r.PuSu=c,"undefined"!=typeof define&&define.amd?(i&&console.log("AMD loader detected"),define(["exports"],o)):"undefined"!=typeof n&&n.browser?(i&&console.log("Looks like a browser"),o(window)):"object"==typeof t&&t.exports?(i&&console.log("Looks like CommonJS"),o(t.exports)):(i&&console.log("Looks like a browser"),o(window))}).call(this,e("_process"))},{"./tsd":3,_process:1}],3:[function(e,t,r){"use strict";function n(){return new u(s)}function o(e){return e instanceof a?e:n().resolve(e).promise}function s(e){setTimeout(e,0)}r.create=n,r.when=o;var i;!function(e){e[e.Pending=0]="Pending",e[e.ResolutionInProgress=1]="ResolutionInProgress",e[e.Resolved=2]="Resolved",e[e.Rejected=3]="Rejected"}(i||(i={}));var c=function(){function e(e,t,r){this._dispatcher=e,this._successCB=t,this._errorCB=r,this.result=new u(e)}return e.prototype.resolve=function(e,t){var r=this;return"function"!=typeof this._successCB?void this.result.resolve(e):void(t?this._dispatcher(function(){return r._dispatchCallback(r._successCB,e)}):this._dispatchCallback(this._successCB,e))},e.prototype.reject=function(e,t){var r=this;return"function"!=typeof this._errorCB?void this.result.reject(e):void(t?this._dispatcher(function(){return r._dispatchCallback(r._errorCB,e)}):this._dispatchCallback(this._errorCB,e))},e.prototype._dispatchCallback=function(e,t){var r;try{r=e(t),this.result.resolve(r)}catch(n){return void this.result.reject(n)}},e}(),u=function(){function e(e){this._dispatcher=e,this._stack=[],this._state=i.Pending,this.promise=new a(this)}return e.prototype._then=function(e,t){if("function"!=typeof e&&"function"!=typeof t)return this.promise;var r=new c(this._dispatcher,e,t);switch(this._state){case i.Pending:case i.ResolutionInProgress:this._stack.push(r);break;case i.Resolved:r.resolve(this._value,!0);break;case i.Rejected:r.reject(this._error,!0)}return r.result.promise},e.prototype.resolve=function(e){return this._state!==i.Pending?this:this._resolve(e)},e.prototype._resolve=function(e){var t,r=this,n=typeof e,o=!0;try{if(null===e||"object"!==n&&"function"!==n||"function"!=typeof(t=e.then))this._state=i.ResolutionInProgress,this._dispatcher(function(){r._state=i.Resolved,r._value=e;var t,n=r._stack.length;for(t=0;n>t;t++)r._stack[t].resolve(e,!1);r._stack.splice(0,n)});else{if(e===this.promise)throw new TypeError("recursive resolution");this._state=i.ResolutionInProgress,t.call(e,function(e){o&&(o=!1,r._resolve(e))},function(e){o&&(o=!1,r._reject(e))})}}catch(s){o&&this._reject(s)}return this},e.prototype.reject=function(e){return this._state!==i.Pending?this:this._reject(e)},e.prototype._reject=function(e){var t=this;return this._state=i.ResolutionInProgress,this._dispatcher(function(){t._state=i.Rejected,t._error=e;var r=t._stack.length,n=0;for(n=0;r>n;n++)t._stack[n].reject(e,!1);t._stack.splice(0,r)}),this},e}(),a=function(){function e(e){this._deferred=e}return e.prototype.then=function(e,t){return this._deferred._then(e,t)},e.prototype.otherwise=function(e){return this._deferred._then(void 0,e)},e.prototype.always=function(e){return this._deferred._then(e,e)},e}()},{}]},{},[2]);
